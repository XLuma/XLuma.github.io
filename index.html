<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Universal warp randomizer</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Asap:400,500,600,700&amp;display=swap"
    />
    <link rel="stylesheet" href="assets/css/styles.css" />

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/vega@5"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/vega-lite@5"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/vega-embed@6"
    ></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/tabulator-tables@4.9.3/dist/js/tabulator.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bokeh.org/bokeh/release/bokeh-2.4.2.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.4.2.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.4.2.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/@holoviz/panel@0.13.0/dist/panel.min.js"
    ></script>
    <script type="text/javascript">
      Bokeh.set_log_level("info");
    </script>

    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script
      defer
      src="https://pyscript.net/releases/2022.12.1/pyscript.js"
    ></script>
  </head>

  <body
    style="background: rgb(54, 53, 53); cursor: url(assets/img/icon.png), auto"
  >
    <py-config type="toml">
      packages = ["numpy", "pandas", "panel==0.13.1a2", "activejson", "./crcmod-1.7-py3-none-any.whl", "ndspy", "more_itertools", "ordered_set"]
      terminal = false 
      [[fetch]] 
      files = ["./randomizer_py.zip"]
    </py-config>
    <py-script>
        import asyncio 
        import panel as pn 
        import pandas as pd 
        from panel.io.pyodide import show 
        import os 
        import zipfile 
        import sys 
        import shutil

        print(os.listdir("/")) 
        fileInput = pn.widgets.FileInput(accept='.gba,.nds')
        uploadButton = pn.widgets.Button(name="Randomize", button_type = "primary")
        downloadButton = pn.widgets.FileDownload(button_type = "primary", file="/home/pyodide/output.zip")

        with zipfile.ZipFile("/home/pyodide/randomizer_py.zip","r") as zip_ref:
            zip_ref.extractall() 
        def process_file(event): 
            sys.path.insert(0, '/home/pyodide/randomizer_py') 
            from randomizer_py.WarpRandomizerMain import randomize
            print(fileInput)
            print(os.path.abspath(fileInput.filename))
            with open(f'/home/pyodide/{fileInput.filename}', 'wb') as file:
                file.write(fileInput.value)
            file.close()
            os.makedirs("/home/pyodide/output")
            randomize(fileInput.filename)
            shutil.make_archive("output", 'zip', "/home/pyodide/output")
            os.remove(f'/home/pyodide/{fileInput.filename}')
            shutil.rmtree("/home/pyodide/output")
            print(os.listdir("/home/pyodide"))
            asyncio.ensure_future(show(downloadButton, 'download'))
        
        uploadButton.on_click(process_file)
        print(os.listdir("/home/pyodide/"))
        async def show_elements(): 
            await show(fileInput, 'choosefile')
            await show(uploadButton, 'randomize')
        asyncio.ensure_future(show_elements())
    </py-script>

    <section id="top">
      <div>
        <h1
          style="
            color: var(--bs-orange);
            text-align: center;
            font-size: 51.4px;
            margin-bottom: 19px;
            font-family: Asap, sans-serif;
            font-weight: bold;
          "
        >
          Universal warp randomizer
        </h1>
        <div
          class="container"
          style="padding-top: 13px; padding-bottom: 13px; height: 474px"
        >
          <div class="row" style="height: 226px">
            <div class="col">
              <h1
                style="
                  color: var(--bs-orange);
                  padding-top: 24px;
                  font-weight: bold;
                  text-decoration: underline;
                "
              >
                How to use
              </h1>
              <ul style="padding-top: 30px; color: rgb(255, 255, 255)">
                <li>Click choose file and select your game</li>
                <li>Click randomize, and wait</li>
                <li>Click download, and play !</li>
              </ul>
            </div>
            <div class="col">
            <h1 style="text-decoration: underline;color: var(--bs-orange);font-family: Asap, sans-serif;font-weight: bold;padding-top: 24px;">Compatible games</h1>
            <ul style="font-family: Asap, sans-serif;color: rgb(255,255,255);">
                <li>Pokemon Fire Red (1.0 and 1.1</li>
                <li>Pokemon Leaf Green (1.0 and 1.1)</li>
                <li>Pokemon Emerald</li>
                <li>Pokemon Platinum</li>
                <li>Pokemon White 2</li>
              </ul>
          </div>
          </div>
          <div class="row" style="height: 226px">
           <div class="col">
              <div id="choosefile" style="margin-top: 10px;"></div>
              <div id="randomize" style="margin-top: 20px;"></div>
              <div id="inputseed" style="margin-top: 30px;"></div>
              <div id="download" style="margin-top: 40px;"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="whatisthis">
      <div
        style="
          padding-top: 6px;
          padding-bottom: 6px;
          padding-left: 19px;
          padding-right: 19px;
        "
      >
        <h1
          style="
            color: var(--bs-orange);
            padding-left: 0px;
            padding-right: 0px;
            padding-top: 0px;
            padding-bottom: 0px;
            margin-top: 0px;
            margin-bottom: 0px;
            font-family: Asap, sans-serif;
            font-weight: bold;
          "
        >
          What is this ?
        </h1>
        <p
          style="
            color: rgb(255, 255, 255);
            text-align: left;
            border-left-style: solid;
            border-left-color: var(--bs-orange);
            padding: 4px;
            font-family: Asap, sans-serif;
          "
        >
          The Universal Warp Randomizer is a tool that will allow you to randomize the warp points in a Pokemon game, resulting in a fresh experience. Originally made for Twitch Streamer Pointcrow, this web version was made to fix issues with the standalone builds. This version is compatible with any computer and phone, as long as you have access to a web browser.
        </p>
      </div>
    </section>
    <section
      id="in_action"
      style="padding-left: 18px; padding-right: 13px; padding-top: 20px"
    >
      <h1
        style="
          font-family: Asap, sans-serif;
          color: var(--bs-orange);
          font-weight: bold;
          text-decoration: underline;
        "
      >
        See it in action !
      </h1>
      <div
        class="d-md-flex align-items-md-center"
        style="padding-top: 8px; padding-bottom: 13px"
      >
        <iframe
          allowfullscreen=""
          frameborder="0"
          id="emerald"
          class="showcase"
          width="560"
          height="315"
          src="https://www.youtube.com/embed/4C-UmXxVB5c?controls=0"
        ></iframe
        ><iframe
          allowfullscreen=""
          frameborder="0"
          id="platinum"
          class="showcase"
          width="560"
          height="315"
          src="https://www.youtube.com/embed/LzRC6zTr5go?controls=0"
          style="padding-left: 3px"
        ></iframe>
      </div>
    </section>
    <section
      id="whoweare"
      style="
        margin-top: 10px;
        margin-right: 0px;
        padding-left: 20px;
        padding-right: 10px;
      "
    >
      <h1
        style="
          color: var(--bs-orange);
          font-weight: bold;
          padding-bottom: 6px;
          text-decoration: underline;
        "
      >
        Who we are
      </h1>

      <div class="profilepics">
        <a
          class="profile_link grid-item"
          href="https://twitter.com/TheFanatiker"
        >
          <img
            class="profilepic_image"
            width="150px"
            height="150px"
            src="assets/img/crop_luma.jpg"
          />

          <h1 class="profilepic_name">XLuma</h1>
        </a>

        <a class="profile_link grid-item" href="https://twitter.com/atsign8877">
          <img
            class="profilepic_image"
            width="150px"
            height="150px"
            src="assets/img/Vdw22WPB_400x400.jpg"
          />

          <h1 class="profilepic_name">Atsign</h1>
        </a>

        <a
          class="profile_link grid-item"
          href="https://twitter.com/Turtleisaac"
        >
          <img
            class="profilepic_image"
            width="150px"
            height="150px"
            src="assets/img/turtleisaac.png"
          />

          <h1 class="profilepic_name">Turtleisaac</h1>
        </a>
      </div>
    </section>
    <div style="margin-bottom: 0px; padding-bottom: 9px"></div>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>
